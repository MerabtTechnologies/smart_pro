var V=(O,x,j)=>new Promise((D,R)=>{var b=d=>{try{v(j.next(d))}catch(m){R(m)}},k=d=>{try{v(j.throw(d))}catch(m){R(m)}},v=d=>d.done?D(d.value):Promise.resolve(d.value).then(b,k);v((j=j.apply(O,x)).next())});import{f as oe,r as g,c as S,a as ne,A as N,q as o,t as a,z as I,i as re,l as i,n as s,v as u,k as p,F as $,O as L,x as n,y as c,N as _,P as z,R as ue}from"./frappe-ui-5f3Xtay5.js";import{o as de,j as H,k as q,m as Y,z as ie,l as W,B as pe,C as T,e as w,u as G,v as ce,w as me,d as y,g as J,O as fe,P as ve,p as _e,f as ge,n as A,Q as ye,R as xe,S as be,E as ke,K,L as we,J as je,i as Re,M as E}from"./index-B4zCsaYM.js";import{u as Ce}from"./usePermissions-DkJGg_er.js";const Ie={key:0,class:"p-4"},De={key:1,class:"empty-state h-full"},Ve={class:"empty-state-description"},Ae={key:2,class:"p-4"},Ee={class:"flex justify-between items-start mb-2"},Pe={class:"text-xs text-gray-500 uppercase"},Te={class:"font-semibold text-gray-800"},Be={class:"flex items-center text-sm text-gray-600 mb-2"},Me={class:"ml-2 text-blue-600"},qe={key:0,class:"text-sm text-gray-600 mb-2 line-clamp-2"},Oe={key:1,class:"mb-2 bg-blue-50 rounded text-sm overflow-hidden"},Ue=["onClick"],he=["innerHTML"],Fe={key:2,class:"text-xs text-gray-500"},Se={key:3,class:"mt-2 p-2 bg-gray-50 rounded text-sm"},Ne={key:4,class:"mt-2 text-xs text-green-600"},$e={key:5,class:"mt-3 pt-3 border-t border-gray-100"},Le={class:"flex flex-wrap gap-2"},ze={key:6,class:"mt-3 pt-3 border-t border-gray-100"},He={class:"mb-4"},Ye={class:"mb-4"},We={key:0,class:"mb-4 p-3 bg-blue-50 rounded-lg"},Ge={class:"text-blue-800 font-medium"},Je={class:"mb-4"},Ke={key:1,class:"mt-4 p-3 bg-red-50 text-red-600 rounded-lg text-sm"},Qe=3e4,Xe={__name:"DateRequests",setup(O){const x=re("$dayjs"),{fetchPermissions:j,hasFullAccess:D}=Ce(),R=g(!0),b=g(!1),k=g(!1),v=g(""),d=g("pending"),m=g([]),Q=g(""),P=g({});function X(l){P.value[l]=!P.value[l]}const U=S(()=>d.value==="all"?m.value:d.value==="pending"?m.value.filter(l=>l.status==="Pending Approval"):d.value==="approved"?m.value.filter(l=>l.status==="Approved"):d.value==="rejected"?m.value.filter(l=>l.status==="Rejected"):m.value),r=g({name:"",from_date:"",to_date:"",reason:""}),h=S(()=>{if(!r.value.from_date||!r.value.to_date)return 0;const l=x(r.value.from_date),e=x(r.value.to_date);return e.isBefore(l)?0:e.diff(l,"day")+1});let B=0;function C(l=!1){return V(this,null,function*(){const e=Date.now();if(!(!l&&B&&e-B<Qe&&m.value.length>0)){R.value=m.value.length===0;try{yield j();let t;D.value?t=yield I("smart_pro.smart_pro.api.projects.get_all_date_requests"):t=yield I("smart_pro.smart_pro.api.projects.get_my_date_requests");const f=yield I("frappe.auth.get_logged_user");m.value=t||[],Q.value=f||"",B=e}catch(t){console.error("Error loading data:",t)}finally{R.value=!1}}})}function Z(l){C(!0).finally(()=>{l.target.complete()})}function F(l){return l?x(l).format("MMM D, YYYY"):"-"}function M(l){return l?l.replace(/<[^>]*>/g,""):""}function ee(l){return{Draft:"planning","Pending Approval":"on-hold",Approved:"completed",Rejected:"cancelled",Cancelled:"cancelled"}[l]||""}function te(l){r.value={name:l.name,from_date:l.from_date,to_date:l.to_date,reason:M(l.reason||"")},v.value="",b.value=!0}function ae(){return V(this,null,function*(){var t;if(!r.value.from_date||!r.value.to_date){v.value="From date and to date are required";return}const l=x(r.value.from_date);if(x(r.value.to_date).isBefore(l)){v.value="To date cannot be before from date";return}k.value=!0,v.value="";try{yield I("smart_pro.smart_pro.api.projects.update_date_request",{request_id:r.value.name,from_date:r.value.from_date,to_date:r.value.to_date,reason:r.value.reason||null}),yield(yield E.create({message:"Date request updated successfully!",duration:2e3,color:"success"})).present(),b.value=!1,yield C()}catch(f){console.error("Error updating request:",f),v.value=((t=f.messages)==null?void 0:t[0])||f.message||"Failed to update request"}finally{k.value=!1}})}function se(l){return V(this,null,function*(){var e;try{yield I("smart_pro.smart_pro.api.projects.approve_date_request",{request_id:l.name,status:"Approved"}),yield(yield E.create({message:"Request approved successfully!",duration:2e3,color:"success"})).present(),yield C()}catch(t){console.error("Error approving request:",t),yield(yield E.create({message:((e=t.messages)==null?void 0:e[0])||t.message||"Failed to approve request",duration:3e3,color:"danger"})).present()}})}function le(l){return V(this,null,function*(){var e;try{yield I("smart_pro.smart_pro.api.projects.approve_date_request",{request_id:l.name,status:"Rejected"}),yield(yield E.create({message:"Request rejected",duration:2e3,color:"warning"})).present(),yield C()}catch(t){console.error("Error rejecting request:",t),yield(yield E.create({message:((e=t.messages)==null?void 0:e[0])||t.message||"Failed to reject request",duration:3e3,color:"danger"})).present()}})}return ne(()=>{C()}),de(()=>{C()}),(l,e)=>(i(),N(a(Re),null,{default:o(()=>[s(a(H),null,{default:o(()=>[s(a(q),null,{default:o(()=>[s(a(Y),{slot:"start"},{default:o(()=>[s(a(ie),{"default-href":"/smart-pro/home",text:""})]),_:1}),s(a(W),null,{default:o(()=>[...e[6]||(e[6]=[u("Date Requests",-1)])]),_:1})]),_:1}),s(a(q),null,{default:o(()=>[s(a(pe),{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=t=>d.value=t),scrollable:""},{default:o(()=>[s(a(T),{value:"all"},{default:o(()=>[s(a(w),null,{default:o(()=>[...e[7]||(e[7]=[u("All",-1)])]),_:1})]),_:1}),s(a(T),{value:"pending"},{default:o(()=>[s(a(w),null,{default:o(()=>[...e[8]||(e[8]=[u("Pending",-1)])]),_:1})]),_:1}),s(a(T),{value:"approved"},{default:o(()=>[s(a(w),null,{default:o(()=>[...e[9]||(e[9]=[u("Approved",-1)])]),_:1})]),_:1}),s(a(T),{value:"rejected"},{default:o(()=>[s(a(w),null,{default:o(()=>[...e[10]||(e[10]=[u("Rejected",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(a(G),{fullscreen:!0},{default:o(()=>[s(a(ce),{slot:"fixed",onIonRefresh:Z},{default:o(()=>[s(a(me))]),_:1}),R.value?(i(),p("div",Ie,[(i(),p($,null,L(3,t=>n("div",{key:t,class:"app-card mb-4 p-4"},[...e[11]||(e[11]=[n("div",{class:"skeleton h-5 w-3/4 mb-2"},null,-1),n("div",{class:"skeleton h-4 w-1/2 mb-2"},null,-1),n("div",{class:"skeleton h-3 w-full"},null,-1)])])),64))])):U.value.length===0?(i(),p("div",De,[s(a(y),{icon:a(J),class:"empty-state-icon"},null,8,["icon"]),e[12]||(e[12]=n("div",{class:"empty-state-title"},"No date requests",-1)),n("div",Ve,c(d.value==="pending"?"No pending requests":d.value==="approved"?"No approved requests":d.value==="rejected"?"No rejected requests":"Your date requests will appear here"),1)])):(i(),p("div",Ae,[(i(!0),p($,null,L(U.value,t=>(i(),p("div",{key:t.name,class:"app-card mb-4 p-4"},[n("div",Ee,[n("div",null,[n("span",Pe,c(t.request_type),1),n("h3",Te,c(t.project_title||t.project||"General Request"),1)]),n("span",{class:z(["status-badge",ee(t.status)])},c(t.status),3)]),n("div",Be,[s(a(y),{icon:a(J),class:"mr-1"},null,8,["icon"]),u(" "+c(F(t.from_date))+" - "+c(F(t.to_date))+" ",1),n("span",Me,"("+c(t.total_days)+" days)",1)]),t.reason?(i(),p("div",qe,c(M(t.reason)),1)):_("",!0),t.project_scope?(i(),p("div",Oe,[n("div",{class:"flex items-center justify-between p-2 cursor-pointer",onClick:f=>X(t.name)},[e[13]||(e[13]=n("div",{class:"text-xs text-blue-600 font-semibold"},"Project Scope:",-1)),s(a(y),{icon:P.value[t.name]?a(fe):a(ve),class:"text-blue-600"},null,8,["icon"])],8,Ue),n("div",{class:z(["scope-content px-2 pb-2",{expanded:P.value[t.name]}])},[n("div",{class:"text-gray-700 whitespace-pre-wrap",innerHTML:t.project_scope},null,8,he)],2)])):_("",!0),t.approver?(i(),p("div",Fe,[s(a(y),{icon:a(_e),class:"mr-1"},null,8,["icon"]),u(" Approver: "+c(t.approver),1)])):_("",!0),t.comments&&t.status!=="Pending Approval"?(i(),p("div",Se,[e[14]||(e[14]=n("span",{class:"font-medium"},"Comments:",-1)),u(" "+c(M(t.comments)),1)])):_("",!0),t.auto_create_tasks&&t.request_type==="Project Date Update"?(i(),p("div",Ne,[s(a(y),{icon:a(ge),class:"mr-1"},null,8,["icon"]),e[15]||(e[15]=u(" Tasks will be auto-created on approval ",-1))])):_("",!0),t.status==="Pending Approval"&&!a(D)?(i(),p("div",$e,[n("div",Le,[s(a(A),{size:"small",fill:"outline",color:"primary",onClick:f=>te(t)},{default:o(()=>[s(a(y),{icon:a(ye),slot:"start"},null,8,["icon"]),e[16]||(e[16]=u(" Edit Dates ",-1))]),_:1},8,["onClick"]),s(a(A),{size:"small",fill:"solid",color:"success",onClick:f=>se(t)},{default:o(()=>[s(a(y),{icon:a(xe),slot:"start"},null,8,["icon"]),e[17]||(e[17]=u(" Approve ",-1))]),_:1},8,["onClick"]),s(a(A),{size:"small",fill:"outline",color:"danger",onClick:f=>le(t)},{default:o(()=>[s(a(y),{icon:a(be),slot:"start"},null,8,["icon"]),e[18]||(e[18]=u(" Reject ",-1))]),_:1},8,["onClick"])])])):_("",!0),t.status==="Pending Approval"&&a(D)?(i(),p("div",ze,[...e[19]||(e[19]=[n("div",{class:"text-xs text-gray-500 italic"}," View only mode - Full access users cannot approve/reject date requests ",-1)])])):_("",!0)]))),128))]))]),_:1}),s(a(ke),{"is-open":b.value,onDidDismiss:e[5]||(e[5]=t=>b.value=!1)},{default:o(()=>[s(a(H),null,{default:o(()=>[s(a(q),null,{default:o(()=>[s(a(W),null,{default:o(()=>[...e[20]||(e[20]=[u("Edit Dates",-1)])]),_:1}),s(a(Y),{slot:"end"},{default:o(()=>[s(a(A),{onClick:e[1]||(e[1]=t=>b.value=!1)},{default:o(()=>[...e[21]||(e[21]=[u("Close",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),s(a(G),{class:"ion-padding"},{default:o(()=>[n("form",{onSubmit:ue(ae,["prevent"])},[n("div",He,[s(a(w),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:o(()=>[...e[22]||(e[22]=[u(" From Date * ",-1)])]),_:1}),s(a(K),{modelValue:r.value.from_date,"onUpdate:modelValue":e[2]||(e[2]=t=>r.value.from_date=t),type:"date",fill:"outline",required:""},null,8,["modelValue"])]),n("div",Ye,[s(a(w),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:o(()=>[...e[23]||(e[23]=[u(" To Date * ",-1)])]),_:1}),s(a(K),{modelValue:r.value.to_date,"onUpdate:modelValue":e[3]||(e[3]=t=>r.value.to_date=t),type:"date",fill:"outline",required:""},null,8,["modelValue"])]),h.value>0?(i(),p("div",We,[n("span",Ge,"Total: "+c(h.value)+" days",1)])):_("",!0),n("div",Je,[s(a(w),{class:"block text-sm font-medium text-gray-700 mb-1"},{default:o(()=>[...e[24]||(e[24]=[u(" Reason / Work Description ",-1)])]),_:1}),s(a(we),{modelValue:r.value.reason,"onUpdate:modelValue":e[4]||(e[4]=t=>r.value.reason=t),placeholder:"Update reason if needed...",fill:"outline",rows:4},null,8,["modelValue"])]),s(a(A),{expand:"block",type:"submit",disabled:k.value,class:"mt-6"},{default:o(()=>[k.value?(i(),N(a(je),{key:0,name:"crescent",class:"mr-2"})):_("",!0),u(" "+c(k.value?"Updating...":"Update Request"),1)]),_:1},8,["disabled"]),v.value?(i(),p("div",Ke,c(v.value),1)):_("",!0)],32)]),_:1})]),_:1},8,["is-open"])]),_:1}))}},st=oe(Xe,[["__scopeId","data-v-6b9e734f"]]);export{st as default};
//# sourceMappingURL=DateRequests-CHXo7gAE.js.map
